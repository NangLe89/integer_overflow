<HTML>
<head><script src="../../resources/jquery.js"></script><script>$(document).ready(function(event) {$(document.location.hash).css('background', 'yellow');$(document.location.hash + ' span').css('color', 'red');});</script></head><BODY BGCOLOR="white">
<PRE>
<span id="line-1"><span style="color: green">001</span>    import java.util.*;<a name="line-1"></a></span>
<span id="line-2"><span style="color: green">002</span>    <a name="line-2"></a></span>
<span id="line-3"><span style="color: green">003</span>    aspect CFG{<a name="line-3"></a></span>
<span id="line-4"><span style="color: green">004</span>      syn Integer Stmt.Label() = new Integer(getl());<a name="line-4"></a></span>
<span id="line-5"><span style="color: green">005</span>    <a name="line-5"></a></span>
<span id="line-6"><span style="color: green">006</span>      syn Integer Stmt.init() = Label();<a name="line-6"></a></span>
<span id="line-7"><span style="color: green">007</span>      eq Block.init() = getStmt(0).init();<a name="line-7"></a></span>
<span id="line-8"><span style="color: green">008</span>      eq ForStmt.init() = getInitStmt(0).init();<a name="line-8"></a></span>
<span id="line-9"><span style="color: green">009</span>      eq DoStmt.init() = getStmt().init();<a name="line-9"></a></span>
<span id="line-10"><span style="color: green">010</span>    <a name="line-10"></a></span>
<span id="line-11"><span style="color: green">011</span>      syn Set&lt;Integer&gt; Stmt.finals(){<a name="line-11"></a></span>
<span id="line-12"><span style="color: green">012</span>        Set&lt;Integer&gt; ret = new HashSet&lt;Integer&gt;();<a name="line-12"></a></span>
<span id="line-13"><span style="color: green">013</span>        ret.add(Label());<a name="line-13"></a></span>
<span id="line-14"><span style="color: green">014</span>        return ret;<a name="line-14"></a></span>
<span id="line-15"><span style="color: green">015</span>      }<a name="line-15"></a></span>
<span id="line-16"><span style="color: green">016</span>      eq IfStmt.finals(){<a name="line-16"></a></span>
<span id="line-17"><span style="color: green">017</span>        Set&lt;Integer&gt; ret = new HashSet&lt;Integer&gt;();<a name="line-17"></a></span>
<span id="line-18"><span style="color: green">018</span>        ret.addAll(getThen().finals());<a name="line-18"></a></span>
<span id="line-19"><span style="color: green">019</span>        ret.addAll(getElse().finals());<a name="line-19"></a></span>
<span id="line-20"><span style="color: green">020</span>        return ret;<a name="line-20"></a></span>
<span id="line-21"><span style="color: green">021</span>      }<a name="line-21"></a></span>
<span id="line-22"><span style="color: green">022</span>      eq Block.finals() = getStmt(getNumStmt()-1).finals(); <a name="line-22"></a></span>
<span id="line-23"><span style="color: green">023</span>    <a name="line-23"></a></span>
<span id="line-24"><span style="color: green">024</span>      syn Set&lt;Stmt&gt; Stmt.blocks(){<a name="line-24"></a></span>
<span id="line-25"><span style="color: green">025</span>        Set&lt;Stmt&gt; ret = new HashSet&lt;Stmt&gt;();<a name="line-25"></a></span>
<span id="line-26"><span style="color: green">026</span>        ret.add(this);<a name="line-26"></a></span>
<span id="line-27"><span style="color: green">027</span>        return ret;<a name="line-27"></a></span>
<span id="line-28"><span style="color: green">028</span>      }<a name="line-28"></a></span>
<span id="line-29"><span style="color: green">029</span>      eq IfStmt.blocks(){<a name="line-29"></a></span>
<span id="line-30"><span style="color: green">030</span>        Set&lt;Stmt&gt; ret = new HashSet&lt;Stmt&gt;();<a name="line-30"></a></span>
<span id="line-31"><span style="color: green">031</span>        ret.add(this);<a name="line-31"></a></span>
<span id="line-32"><span style="color: green">032</span>        ret.addAll(getThen().blocks());<a name="line-32"></a></span>
<span id="line-33"><span style="color: green">033</span>        ret.addAll(getElse().blocks());<a name="line-33"></a></span>
<span id="line-34"><span style="color: green">034</span>        return ret;<a name="line-34"></a></span>
<span id="line-35"><span style="color: green">035</span>      }<a name="line-35"></a></span>
<span id="line-36"><span style="color: green">036</span>      eq Block.blocks(){<a name="line-36"></a></span>
<span id="line-37"><span style="color: green">037</span>        Set&lt;Stmt&gt; ret = new HashSet&lt;Stmt&gt;();<a name="line-37"></a></span>
<span id="line-38"><span style="color: green">038</span>        ret.add(this);<a name="line-38"></a></span>
<span id="line-39"><span style="color: green">039</span>        for(Stmt s : getStmts())<a name="line-39"></a></span>
<span id="line-40"><span style="color: green">040</span>          ret.addAll(s.blocks());<a name="line-40"></a></span>
<span id="line-41"><span style="color: green">041</span>        return ret;<a name="line-41"></a></span>
<span id="line-42"><span style="color: green">042</span>      }<a name="line-42"></a></span>
<span id="line-43"><span style="color: green">043</span>      eq ForStmt.blocks(){<a name="line-43"></a></span>
<span id="line-44"><span style="color: green">044</span>        Set&lt;Stmt&gt; ret = new HashSet&lt;Stmt&gt;();<a name="line-44"></a></span>
<span id="line-45"><span style="color: green">045</span>        ret.add(this);<a name="line-45"></a></span>
<span id="line-46"><span style="color: green">046</span>        ret.addAll(getStmt().blocks());<a name="line-46"></a></span>
<span id="line-47"><span style="color: green">047</span>        for(Stmt s : getInitStmts())<a name="line-47"></a></span>
<span id="line-48"><span style="color: green">048</span>          ret.addAll(s.blocks());<a name="line-48"></a></span>
<span id="line-49"><span style="color: green">049</span>        for(Stmt s : getUpdateStmts())<a name="line-49"></a></span>
<span id="line-50"><span style="color: green">050</span>          ret.addAll(s.blocks());<a name="line-50"></a></span>
<span id="line-51"><span style="color: green">051</span>        return ret; <a name="line-51"></a></span>
<span id="line-52"><span style="color: green">052</span>      }<a name="line-52"></a></span>
<span id="line-53"><span style="color: green">053</span>      eq WhileStmt.blocks(){<a name="line-53"></a></span>
<span id="line-54"><span style="color: green">054</span>        Set&lt;Stmt&gt; ret = new HashSet&lt;Stmt&gt;();<a name="line-54"></a></span>
<span id="line-55"><span style="color: green">055</span>        ret.add(this);<a name="line-55"></a></span>
<span id="line-56"><span style="color: green">056</span>        ret.addAll(getStmt().blocks());<a name="line-56"></a></span>
<span id="line-57"><span style="color: green">057</span>        return ret;<a name="line-57"></a></span>
<span id="line-58"><span style="color: green">058</span>      }<a name="line-58"></a></span>
<span id="line-59"><span style="color: green">059</span>      eq DoStmt.blocks(){<a name="line-59"></a></span>
<span id="line-60"><span style="color: green">060</span>        Set&lt;Stmt&gt; ret = new HashSet&lt;Stmt&gt;();<a name="line-60"></a></span>
<span id="line-61"><span style="color: green">061</span>        ret.add(this);<a name="line-61"></a></span>
<span id="line-62"><span style="color: green">062</span>        ret.addAll(getStmt().blocks());<a name="line-62"></a></span>
<span id="line-63"><span style="color: green">063</span>        return ret;<a name="line-63"></a></span>
<span id="line-64"><span style="color: green">064</span>      }<a name="line-64"></a></span>
<span id="line-65"><span style="color: green">065</span>    <a name="line-65"></a></span>
<span id="line-66"><span style="color: green">066</span>      syn Set&lt;Integer&gt; Program.labels(){<a name="line-66"></a></span>
<span id="line-67"><span style="color: green">067</span>        Set&lt;Integer&gt; ret = new HashSet&lt;Integer&gt;();<a name="line-67"></a></span>
<span id="line-68"><span style="color: green">068</span>        for(Stmt s : getStmt().blocks())<a name="line-68"></a></span>
<span id="line-69"><span style="color: green">069</span>          ret.add(s.Label());<a name="line-69"></a></span>
<span id="line-70"><span style="color: green">070</span>        return ret;<a name="line-70"></a></span>
<span id="line-71"><span style="color: green">071</span>      }  <a name="line-71"></a></span>
<span id="line-72"><span style="color: green">072</span>    <a name="line-72"></a></span>
<span id="line-73"><span style="color: green">073</span>      syn Set&lt;Pair&gt; Stmt.flow() = new HashSet&lt;Pair&gt;();<a name="line-73"></a></span>
<span id="line-74"><span style="color: green">074</span>      eq IfStmt.flow(){<a name="line-74"></a></span>
<span id="line-75"><span style="color: green">075</span>        Set&lt;Pair&gt; ret = new HashSet&lt;Pair&gt;();<a name="line-75"></a></span>
<span id="line-76"><span style="color: green">076</span>        ret.addAll(getThen().flow());<a name="line-76"></a></span>
<span id="line-77"><span style="color: green">077</span>        ret.addAll(getElse().flow());<a name="line-77"></a></span>
<span id="line-78"><span style="color: green">078</span>        ret.add(new Pair(Label(), getThen().init()));<a name="line-78"></a></span>
<span id="line-79"><span style="color: green">079</span>        ret.add(new Pair(Label(), getElse().init()));<a name="line-79"></a></span>
<span id="line-80"><span style="color: green">080</span>        return ret;<a name="line-80"></a></span>
<span id="line-81"><span style="color: green">081</span>      } <a name="line-81"></a></span>
<span id="line-82"><span style="color: green">082</span>      eq Block.flow(){<a name="line-82"></a></span>
<span id="line-83"><span style="color: green">083</span>        Set&lt;Pair&gt; ret = new HashSet&lt;Pair&gt;();<a name="line-83"></a></span>
<span id="line-84"><span style="color: green">084</span>        for(Stmt s : getStmts())<a name="line-84"></a></span>
<span id="line-85"><span style="color: green">085</span>          ret.addAll(s.flow());<a name="line-85"></a></span>
<span id="line-86"><span style="color: green">086</span>        for(int i = 0; i &lt; getNumStmt()-1; i++)<a name="line-86"></a></span>
<span id="line-87"><span style="color: green">087</span>          for(Integer l : getStmt(i).finals())<a name="line-87"></a></span>
<span id="line-88"><span style="color: green">088</span>            ret.add(new Pair(l, getStmt(i+1).init())); <a name="line-88"></a></span>
<span id="line-89"><span style="color: green">089</span>        return ret; <a name="line-89"></a></span>
<span id="line-90"><span style="color: green">090</span>      }<a name="line-90"></a></span>
<span id="line-91"><span style="color: green">091</span>      eq ForStmt.flow(){<a name="line-91"></a></span>
<span id="line-92"><span style="color: green">092</span>        Set&lt;Pair&gt; ret = new HashSet&lt;Pair&gt;();<a name="line-92"></a></span>
<span id="line-93"><span style="color: green">093</span>        for(int i = 0; i &lt; getNumInitStmt()-1; i++)<a name="line-93"></a></span>
<span id="line-94"><span style="color: green">094</span>          for(Integer l : getInitStmt(i).finals())<a name="line-94"></a></span>
<span id="line-95"><span style="color: green">095</span>            ret.add(new Pair(l, getInitStmt(i+1).init()));<a name="line-95"></a></span>
<span id="line-96"><span style="color: green">096</span>        for(Integer l : getInitStmt(getNumInitStmt()-1).finals())<a name="line-96"></a></span>
<span id="line-97"><span style="color: green">097</span>        ret.add(new Pair(l, getStmt().init()));<a name="line-97"></a></span>
<span id="line-98"><span style="color: green">098</span>        ret.addAll(getStmt().flow());<a name="line-98"></a></span>
<span id="line-99"><span style="color: green">099</span>        for(Integer l : getStmt().finals())<a name="line-99"></a></span>
<span id="line-100"><span style="color: green">100</span>          ret.add(new Pair(l, getUpdateStmt(0).init()));<a name="line-100"></a></span>
<span id="line-101"><span style="color: green">101</span>        for(int i = 0; i &lt; getNumUpdateStmt()-1; i++)<a name="line-101"></a></span>
<span id="line-102"><span style="color: green">102</span>          for(Integer l : getUpdateStmt(i).finals())<a name="line-102"></a></span>
<span id="line-103"><span style="color: green">103</span>            ret.add(new Pair(l, getUpdateStmt(i+1).init()));<a name="line-103"></a></span>
<span id="line-104"><span style="color: green">104</span>        for(Integer l : getUpdateStmt(getNumUpdateStmt()-1).finals())<a name="line-104"></a></span>
<span id="line-105"><span style="color: green">105</span>          ret.add(new Pair(l, Label()));<a name="line-105"></a></span>
<span id="line-106"><span style="color: green">106</span>        ret.add(new Pair(Label(), getStmt().init()));<a name="line-106"></a></span>
<span id="line-107"><span style="color: green">107</span>        return ret;<a name="line-107"></a></span>
<span id="line-108"><span style="color: green">108</span>      }<a name="line-108"></a></span>
<span id="line-109"><span style="color: green">109</span>      eq WhileStmt.flow(){<a name="line-109"></a></span>
<span id="line-110"><span style="color: green">110</span>        Set&lt;Pair&gt; ret = new HashSet&lt;Pair&gt;();<a name="line-110"></a></span>
<span id="line-111"><span style="color: green">111</span>        ret.add(new Pair(Label(), getStmt().init()));<a name="line-111"></a></span>
<span id="line-112"><span style="color: green">112</span>        for(Integer l : getStmt().finals())<a name="line-112"></a></span>
<span id="line-113"><span style="color: green">113</span>          ret.add(new Pair(l, Label()));<a name="line-113"></a></span>
<span id="line-114"><span style="color: green">114</span>        ret.addAll(getStmt().flow());<a name="line-114"></a></span>
<span id="line-115"><span style="color: green">115</span>        return ret;<a name="line-115"></a></span>
<span id="line-116"><span style="color: green">116</span>      }<a name="line-116"></a></span>
<span id="line-117"><span style="color: green">117</span>      eq DoStmt.flow(){<a name="line-117"></a></span>
<span id="line-118"><span style="color: green">118</span>        Set&lt;Pair&gt; ret = new HashSet&lt;Pair&gt;();<a name="line-118"></a></span>
<span id="line-119"><span style="color: green">119</span>        ret.add(new Pair(Label(), getStmt().init()));<a name="line-119"></a></span>
<span id="line-120"><span style="color: green">120</span>        for(Integer l : getStmt().finals())<a name="line-120"></a></span>
<span id="line-121"><span style="color: green">121</span>          ret.add(new Pair(l, Label()));<a name="line-121"></a></span>
<span id="line-122"><span style="color: green">122</span>        ret.addAll(getStmt().flow());<a name="line-122"></a></span>
<span id="line-123"><span style="color: green">123</span>        return ret;<a name="line-123"></a></span>
<span id="line-124"><span style="color: green">124</span>      } <a name="line-124"></a></span>
<span id="line-125"><span style="color: green">125</span>    <a name="line-125"></a></span>
<span id="line-126"><span style="color: green">126</span>    public boolean Stmt.equals(Object oth){<a name="line-126"></a></span>
<span id="line-127"><span style="color: green">127</span>        if(oth == null || !(oth instanceof Stmt)) { return false; }<a name="line-127"></a></span>
<span id="line-128"><span style="color: green">128</span>        Stmt b = (Stmt) oth;<a name="line-128"></a></span>
<span id="line-129"><span style="color: green">129</span>        return Label().equals(b.Label());<a name="line-129"></a></span>
<span id="line-130"><span style="color: green">130</span>    }<a name="line-130"></a></span>
<span id="line-131"><span style="color: green">131</span>      public void Program.PrintCFG(){<a name="line-131"></a></span>
<span id="line-132"><span style="color: green">132</span>         System.out.print("Labels = ");<a name="line-132"></a></span>
<span id="line-133"><span style="color: green">133</span>         for(Integer l : labels())<a name="line-133"></a></span>
<span id="line-134"><span style="color: green">134</span>           System.out.print(l + " ");<a name="line-134"></a></span>
<span id="line-135"><span style="color: green">135</span>         System.out.println();<a name="line-135"></a></span>
<span id="line-136"><span style="color: green">136</span>         System.out.print("Flows = ");<a name="line-136"></a></span>
<span id="line-137"><span style="color: green">137</span>         for(Pair p : getStmt().flow())<a name="line-137"></a></span>
<span id="line-138"><span style="color: green">138</span>            System.out.print("("+ p.first() + "," + p.second() + ") ");<a name="line-138"></a></span>
<span id="line-139"><span style="color: green">139</span>         System.out.println();<a name="line-139"></a></span>
<span id="line-140"><span style="color: green">140</span>      }<a name="line-140"></a></span>
<span id="line-141"><span style="color: green">141</span>    }<a name="line-141"></a></span>
<span id="line-142"><span style="color: green">142</span>    <a name="line-142"></a></span>
<span id="line-143"><span style="color: green">143</span>    public class Pair{<a name="line-143"></a></span>
<span id="line-144"><span style="color: green">144</span>      private Integer first;<a name="line-144"></a></span>
<span id="line-145"><span style="color: green">145</span>      private Integer second;<a name="line-145"></a></span>
<span id="line-146"><span style="color: green">146</span>      public Pair(Integer first, Integer second){<a name="line-146"></a></span>
<span id="line-147"><span style="color: green">147</span>        this.first = first;<a name="line-147"></a></span>
<span id="line-148"><span style="color: green">148</span>        this.second = second;<a name="line-148"></a></span>
<span id="line-149"><span style="color: green">149</span>      }<a name="line-149"></a></span>
<span id="line-150"><span style="color: green">150</span>      public Integer first(){ return first; }<a name="line-150"></a></span>
<span id="line-151"><span style="color: green">151</span>      public Integer second(){ return second; }<a name="line-151"></a></span>
<span id="line-152"><span style="color: green">152</span>    }<a name="line-152"></a></span>
<span id="line-153"><span style="color: green">153</span>    <a name="line-153"></a></span>
<span id="line-154"><span style="color: green">154</span>    <a name="line-154"></a></span>
</PRE>
</BODY>
</HTML>
